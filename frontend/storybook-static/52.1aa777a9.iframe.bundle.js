"use strict";(self.webpackChunkproxy_agent_platform_frontend=self.webpackChunkproxy_agent_platform_frontend||[]).push([[52],{"./node_modules/.pnpm/lucide-react@0.292.0_react@18.3.1/node_modules/lucide-react/dist/esm/createLucideIcon.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{A:()=>createLucideIcon});var react=__webpack_require__("./node_modules/.pnpm/next@15.5.6_@babel+core@7.28.4_react-dom@18.3.1_react@18.3.1__react@18.3.1/node_modules/next/dist/compiled/react/index.js"),defaultAttributes={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};const createLucideIcon=(iconName,iconNode)=>{const Component=(0,react.forwardRef)(({color="currentColor",size=24,strokeWidth=2,absoluteStrokeWidth,children,...rest},ref)=>{return(0,react.createElement)("svg",{ref,...defaultAttributes,width:size,height:size,stroke:color,strokeWidth:absoluteStrokeWidth?24*Number(strokeWidth)/Number(size):strokeWidth,className:`lucide lucide-${string=iconName,string.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase()}`,...rest},[...iconNode.map(([tag,attrs])=>(0,react.createElement)(tag,attrs)),...(Array.isArray(children)?children:[children])||[]]);var string});return Component.displayName=`${iconName}`,Component}},"./node_modules/.pnpm/lucide-react@0.292.0_react@18.3.1/node_modules/lucide-react/dist/esm/icons/x.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{A:()=>X});const X=(0,__webpack_require__("./node_modules/.pnpm/lucide-react@0.292.0_react@18.3.1/node_modules/lucide-react/dist/esm/createLucideIcon.js").A)("X",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]])},"./src/components/shared/AsyncJobTimeline.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{A:()=>shared_AsyncJobTimeline});var jsx_runtime=__webpack_require__("./node_modules/.pnpm/next@15.5.6_@babel+core@7.28.4_react-dom@18.3.1_react@18.3.1__react@18.3.1/node_modules/next/dist/compiled/react/jsx-runtime.js"),react=__webpack_require__("./node_modules/.pnpm/next@15.5.6_@babel+core@7.28.4_react-dom@18.3.1_react@18.3.1__react@18.3.1/node_modules/next/dist/compiled/react/index.js"),x=__webpack_require__("./node_modules/.pnpm/lucide-react@0.292.0_react@18.3.1/node_modules/lucide-react/dist/esm/icons/x.js");const sizeClasses={sm:"h-1",md:"h-2",lg:"h-3"};function ProgressBar({progress=0,variant="gradient",segments=[],size="sm",animated=!0,className=""}){const isComplete=progress>=100;return"gradient"===variant?(0,jsx_runtime.jsx)("div",{className:`w-full ${sizeClasses[size]} bg-[#002b36] rounded-full overflow-hidden ${className}`,children:(0,jsx_runtime.jsx)("div",{className:`h-full rounded-full ${animated?"transition-all duration-500 ease-out":""} ${isComplete?"bg-[#859900]":"bg-gradient-to-r from-[#268bd2] to-[#2aa198]"}`,style:{width:`${Math.min(progress,100)}%`}})}):"segmented"===variant&&segments.length>0?(0,jsx_runtime.jsx)("div",{className:`flex gap-1 ${sizeClasses[size]} rounded-full overflow-hidden ${className}`,children:segments.map((segment,index)=>(0,jsx_runtime.jsx)("div",{className:""+(animated?"transition-all duration-500 ease-out":""),style:{width:`${segment.percentage}%`,backgroundColor:segment.color},title:segment.label},index))}):(0,jsx_runtime.jsx)("div",{className:`w-full ${sizeClasses[size]} bg-[#002b36] rounded-full overflow-hidden ${className}`})}try{ProgressBar.displayName="ProgressBar",ProgressBar.__docgenInfo={description:"",displayName:"ProgressBar",props:{progress:{defaultValue:{value:"0"},description:"",name:"progress",required:!1,type:{name:"number | undefined"}},variant:{defaultValue:{value:"gradient"},description:"",name:"variant",required:!1,type:{name:"enum",value:[{value:"undefined"},{value:'"gradient"'},{value:'"segmented"'}]}},segments:{defaultValue:{value:"[]"},description:"",name:"segments",required:!1,type:{name:"ProgressBarSegment[] | undefined"}},size:{defaultValue:{value:"sm"},description:"",name:"size",required:!1,type:{name:"enum",value:[{value:"undefined"},{value:'"sm"'},{value:'"md"'},{value:'"lg"'}]}},animated:{defaultValue:{value:"true"},description:"",name:"animated",required:!1,type:{name:"boolean | undefined"}},className:{defaultValue:{value:""},description:"",name:"className",required:!1,type:{name:"string | undefined"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["src/components/shared/ProgressBar.tsx#ProgressBar"]={docgenInfo:ProgressBar.__docgenInfo,name:"ProgressBar",path:"src/components/shared/ProgressBar.tsx#ProgressBar"})}catch(__react_docgen_typescript_loader_error){}var ChevronStep=__webpack_require__("./src/components/mobile/ChevronStep.tsx"),OpenMoji=__webpack_require__("./src/components/shared/OpenMoji.tsx"),console=__webpack_require__("./node_modules/.pnpm/console-browserify@1.2.0/node_modules/console-browserify/index.js");function StepSection({step,index,totalSteps,isExpanded,size,tab,onClick,stepProgressPercent,onRetry,effectiveExpandedId,loadingChildren,hasNestedContent}){const isCollapsed=null!==effectiveExpandedId&&!isExpanded;return(0,jsx_runtime.jsx)("div",{className:"relative overflow-hidden",style:{marginRight:index!==totalSteps-1?"0px":"0",flex:effectiveExpandedId?isExpanded?"1 1 0%":"0 0 40px":"1 1 0%",minWidth:0},children:(0,jsx_runtime.jsxs)(ChevronStep.A,{status:step.status,position:(()=>{const isFirst=0===index,isLast=index===totalSteps-1;return isFirst&&isLast?"single":isFirst?"first":isLast?"last":"middle"})(),size,onClick,isExpanded,width:"100%",children:[isCollapsed?(0,jsx_runtime.jsx)(OpenMoji.A,{emoji:step.icon?step.icon:"DIGITAL"===step.leafType?"ðŸ¤–":"HUMAN"===step.leafType?"ðŸ‘¤":"ðŸ“‹",size:"nano"===size?16:"micro"===size?18:20,variant:"black",engraved:!0}):(0,jsx_runtime.jsx)("span",{style:{fontSize:"nano"===size?"10px":"micro"===size?"11px":"12px",fontWeight:"active"===step.status||"next"===step.status?600:500,color:{pending:"#586e75",active:"#268bd2",done:"#859900",error:"#dc322f",next:"#cb4b16"}[step.status],lineHeight:1,whiteSpace:"nowrap"},children:(()=>{const label=step.shortLabel||step.description;return"nano"===size?isExpanded?label.length>15?`${label.slice(0,15)}...`:label:`${index+1}`:"micro"===size?isExpanded?label.length>18?`${label.slice(0,18)}...`:label:label.length>10?`${label.slice(0,10)}...`:label:isExpanded?label.length>25?`${label.slice(0,25)}...`:label:label.length>12?`${label.slice(0,12)}...`:label})()}),"error"===step.status&&onRetry&&(0,jsx_runtime.jsxs)("div",{style:{position:"absolute",inset:0,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",gap:"4px",backgroundColor:"rgba(0, 0, 0, 0.75)",backdropFilter:"blur(4px)"},children:[(0,jsx_runtime.jsx)("span",{style:{fontSize:"18px",animation:"bounce 1s infinite"},children:"âš ï¸"}),("full"===size||"micro"===size)&&(0,jsx_runtime.jsx)("button",{style:{fontSize:"9px",padding:"2px 8px",backgroundColor:"#dc322f",color:"white",borderRadius:"4px",border:"none",cursor:"pointer",fontWeight:500},onClick:e=>{e.stopPropagation(),onRetry()},children:"Retry"})]}),"active"===step.status&&void 0!==stepProgressPercent&&stepProgressPercent>0&&(0,jsx_runtime.jsx)("div",{style:{position:"absolute",bottom:0,left:0,right:0,height:"2px",backgroundColor:"rgba(147, 161, 161, 0.3)",overflow:"hidden"},children:(0,jsx_runtime.jsx)("div",{style:{height:"100%",backgroundColor:"#268bd2",width:`${stepProgressPercent}%`,transition:"width 0.3s ease-out"}})})]})})}const shared_AsyncJobTimeline=react.memo(function AsyncJobTimeline({jobName,steps,currentProgress,size="full",tab=!0,onClose,onDismiss,onStepClick,onRetryStep,className="",showProgressBar=!0,processingTimeMs,stepProgress}){var _steps_find;const[expandedStepId,setExpandedStepId]=(0,react.useState)(null),[manualExpandId,setManualExpandId]=(0,react.useState)(null),[forceCollapsed,setForceCollapsed]=(0,react.useState)(!1),[expandedStepChildren,setExpandedStepChildren]=(0,react.useState)(new Map),[loadingChildren,setLoadingChildren]=(0,react.useState)(new Set),[decompositionJobs,setDecompositionJobs]=(0,react.useState)(new Map);(0,react.useEffect)(()=>{if(manualExpandId||forceCollapsed)forceCollapsed&&setExpandedStepId(null);else{const activeStep=steps.find(s=>"active"===s.status);setExpandedStepId((null==activeStep?void 0:activeStep.id)||null)}},[steps,manualExpandId,forceCollapsed]);const effectiveExpandedId=manualExpandId||expandedStepId,isComplete=currentProgress>=100;steps.every(s=>"done"===s.status);return(0,jsx_runtime.jsxs)("div",{className:`\n        border rounded overflow-visible\n        ${"nano"===size?"p-1":"p-2"}\n        ${"full"===size?"pt-12":"micro"===size?"pt-10":""}\n        ${className}\n      `,style:{backgroundColor:"#fdf6e3",borderColor:"#eee8d5",boxShadow:"0 1px 3px 0 rgba(0, 0, 0, 0.1), 0 1px 2px -1px rgba(0, 0, 0, 0.1)"},children:["nano"!==size&&(0,jsx_runtime.jsxs)("div",{className:"relative flex items-center justify-center mb-0.5 "+("micro"===size?"-mt-8":"-mt-10"),children:[(0,jsx_runtime.jsx)("p",{className:`line-clamp-1 w-full text-center mb-2 ${"micro"===size?"text-[9px]":"text-[10px]"} font-medium ${effectiveExpandedId?"opacity-0":""}`,style:{color:"#586e75"},children:jobName}),(onClose||onDismiss)&&(0,jsx_runtime.jsx)("button",{onClick:onDismiss||onClose,className:"absolute right-0 transition-colors flex-shrink-0",style:{color:"#93a1a1"},onMouseEnter:e=>e.currentTarget.style.color="#586e75",onMouseLeave:e=>e.currentTarget.style.color="#93a1a1","aria-label":onDismiss?"Dismiss":"Close",children:(0,jsx_runtime.jsx)(x.A,{size:"micro"===size?10:12})})]}),(0,jsx_runtime.jsxs)("div",{className:"relative overflow-visible",children:[(0,jsx_runtime.jsx)("div",{className:"flex gap-0 items-end overflow-visible",children:steps.map((step,index)=>{const hasNestedContent=effectiveExpandedId===step.id&&(decompositionJobs.has(step.id)||expandedStepChildren.has(step.id));return(0,jsx_runtime.jsx)(StepSection,{step,index,totalSteps:steps.length,isExpanded:effectiveExpandedId===step.id,size,tab,onClick:()=>(async stepId=>{const step=steps.find(s=>s.id===stepId),currentlyExpanded=(manualExpandId||expandedStepId)===stepId,isActiveStep="active"===(null==step?void 0:step.status);if(currentlyExpanded)return isActiveStep&&!manualExpandId?setForceCollapsed(!0):manualExpandId===stepId&&(setManualExpandId(null),setForceCollapsed(!1)),void(null==onStepClick||onStepClick(stepId));if(setForceCollapsed(!1),step&&!1===step.isLeaf&&step.decompositionState&&"atomic"!==step.decompositionState)if(expandedStepChildren.has(stepId)||"decomposed"!==step.decompositionState){if(!expandedStepChildren.has(stepId)&&"stub"===step.decompositionState){setLoadingChildren(prev=>new Set(prev).add(stepId));const decompositionSteps=[{id:"analyze",description:"Analyze step complexity",shortLabel:"Analyzing",estimatedMinutes:0,leafType:"DIGITAL",icon:"ðŸ”",status:"pending"},{id:"breakdown",description:"Break down into sub-steps",shortLabel:"Breaking down",estimatedMinutes:0,leafType:"DIGITAL",icon:"ðŸ§©",status:"pending"},{id:"generate",description:"Generate micro-steps",shortLabel:"Generating",estimatedMinutes:0,leafType:"DIGITAL",icon:"âœ¨",status:"pending"}];setDecompositionJobs(prev=>new Map(prev).set(stepId,{steps:decompositionSteps,progress:0}));let currentProgress=0;const progressInterval=setInterval(()=>{currentProgress+=2,currentProgress<=100&&setDecompositionJobs(prev=>{const job=prev.get(stepId);if(!job)return prev;const updatedSteps=job.steps.map((s,i)=>currentProgress>=33*(i+1)?{...s,status:"done"}:currentProgress>=33*i?{...s,status:"active"}:s);return new Map(prev).set(stepId,{steps:updatedSteps,progress:currentProgress})})},100);try{const API_URL="http://192.168.1.26:8000",response=await fetch(`${API_URL}/api/v1/micro-steps/${stepId}/decompose`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({user_id:"default-user"})}),data=await response.json();clearInterval(progressInterval),setDecompositionJobs(prev=>{const job=prev.get(stepId);return job?new Map(prev).set(stepId,{steps:job.steps.map(s=>({...s,status:"done"})),progress:100}):prev});const children=data.children.map(child=>({id:child.step_id,description:child.description,shortLabel:child.short_label,estimatedMinutes:child.estimated_minutes,leafType:child.leaf_type,icon:child.icon,status:"pending",tags:child.tags,parentStepId:child.parent_step_id,level:child.level,isLeaf:child.is_leaf,decompositionState:child.decomposition_state}));setTimeout(()=>{setExpandedStepChildren(prev=>new Map(prev).set(stepId,children)),setDecompositionJobs(prev=>{const next=new Map(prev);return next.delete(stepId),next})},500)}catch(error){console.error("Failed to decompose step:",error),clearInterval(progressInterval),setDecompositionJobs(prev=>{const next=new Map(prev);return next.delete(stepId),next})}finally{setLoadingChildren(prev=>{const next=new Set(prev);return next.delete(stepId),next})}}}else{setLoadingChildren(prev=>new Set(prev).add(stepId));try{const API_URL="http://192.168.1.26:8000",response=await fetch(`${API_URL}/api/v1/micro-steps/${stepId}/children`),children=(await response.json()).children.map(child=>({id:child.step_id,description:child.description,shortLabel:child.short_label,estimatedMinutes:child.estimated_minutes,leafType:child.leaf_type,icon:child.icon,status:child.status||"pending",tags:child.tags,parentStepId:child.parent_step_id,level:child.level,isLeaf:child.is_leaf,decompositionState:child.decomposition_state}));setExpandedStepChildren(prev=>new Map(prev).set(stepId,children))}catch(error){console.error("Failed to fetch children:",error)}finally{setLoadingChildren(prev=>{const next=new Set(prev);return next.delete(stepId),next})}}setManualExpandId(stepId),null==onStepClick||onStepClick(stepId)})(step.id),stepProgressPercent:null==stepProgress?void 0:stepProgress.get(step.id),onRetry:onRetryStep?()=>onRetryStep(step.id):void 0,effectiveExpandedId,loadingChildren,hasNestedContent},step.id)})}),effectiveExpandedId&&(decompositionJobs.has(effectiveExpandedId)||expandedStepChildren.has(effectiveExpandedId))&&(0,jsx_runtime.jsx)("div",{className:"mt-2 px-2 overflow-visible",children:decompositionJobs.has(effectiveExpandedId)?(0,jsx_runtime.jsx)(AsyncJobTimeline,{jobName:"Breaking down...",steps:decompositionJobs.get(effectiveExpandedId).steps,currentProgress:decompositionJobs.get(effectiveExpandedId).progress,size:"full"===size?"micro":"nano",showProgressBar:!1}):(0,jsx_runtime.jsx)(AsyncJobTimeline,{jobName:`${(null===(_steps_find=steps.find(s=>s.id===effectiveExpandedId))||void 0===_steps_find?void 0:_steps_find.shortLabel)||"Step"} breakdown`,steps:expandedStepChildren.get(effectiveExpandedId),currentProgress:0,size:"full"===size?"micro":"nano",showProgressBar:!1})}),showProgressBar&&(isComplete?(0,jsx_runtime.jsx)(ProgressBar,{variant:"segmented",segments:[{percentage:steps.filter(s=>"DIGITAL"===s.leafType).length/steps.length*100,color:"#2aa198",label:`${steps.filter(s=>"DIGITAL"===s.leafType).length} digital steps`},{percentage:steps.filter(s=>"HUMAN"===s.leafType).length/steps.length*100,color:"#6c71c4",label:`${steps.filter(s=>"HUMAN"===s.leafType).length} human steps`}].filter(seg=>seg.percentage>0),size:"sm"}):(0,jsx_runtime.jsx)(ProgressBar,{variant:"gradient",progress:currentProgress,size:"sm"}))]})]})})}}]);