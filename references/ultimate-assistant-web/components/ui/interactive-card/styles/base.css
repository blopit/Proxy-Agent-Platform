/* CSS Variables for dynamic values */
:root {
  /* Card properties */
  --card-perspective: 1000px;
  --card-transition-duration: 250ms;
  --card-transition-timing: cubic-bezier(0.2, 0.0, 0.2, 1);
  --card-shadow-color: rgba(0, 0, 0, 0.12);
  --card-shadow-color-dark: rgba(0, 0, 0, 0.2);
  --card-mask-gradient: radial-gradient(circle at center, black 0%, transparent 70%);
  --card-tilt-factor: 1;
  --card-scale-factor: 1;
  --card-animation-quality: high;
  
  /* Peek effects */
  --peek-min-opacity: 0.25;
  --peek-max-opacity: 1;
  --peek-min-blur: 2px;
  --peek-max-blur: 8px;
  --peek-base-scale: 0.98;
  --peek-active-blur: 7px;
  
  /* Transition Timing */
  --peek-transition-duration: 350ms;
  --peek-transition-timing: cubic-bezier(0.2, 0.0, 0.2, 1);
  --peek-fast-transition: 250ms cubic-bezier(0.2, 0.0, 0.2, 1);
  --peek-slow-transition: 450ms cubic-bezier(0.2, 0.0, 0.2, 1);
  
  /* Glow Effects */
  --portal-glow-color: rgba(120, 120, 240, 0.12);
  --portal-glow-size: 50px;
  --portal-glow-radius: 30px;
  
  /* Card Surface */
  --portal-surface-bg: hsl(var(--card));
  --portal-surface-border: hsl(var(--border));
  --portal-z-index: 50;
}

/* Base layer styles with optimized GPU acceleration */
.layer-inset {
  transform-style: preserve-3d;
  backface-visibility: hidden;
  will-change: transform;
  isolation: isolate;
  transform: translateZ(0); /* Better 3D acceleration */
  pointer-events: none;
}

/* Mobile and reduced motion optimizations */
@media (max-width: 768px), (prefers-reduced-motion: reduce) {
  :root {
    --card-tilt-factor: 0.5;
    --card-scale-factor: 0.25;
    --card-animation-quality: low;
    --peek-min-opacity: 0.35;
    --peek-min-blur: 3px;
    --peek-transition-duration: 250ms;
  }

  .mobile-3d-layer {
    transform-style: flat;
    backface-visibility: visible;
    transition-duration: 150ms;
    will-change: auto;
  }

  .reduce-motion {
    transform: none !important;
    transition: none !important;
    animation: none !important;
  }
}

/* Performance-based optimizations */
@media (prefers-reduced-motion: no-preference) {
  .high-performance {
    transition: none;
    animation: none;
  }

  .low-performance {
    transform-style: flat;
    backface-visibility: visible;
    perspective: none;
    will-change: auto;
  }
}

/* Peek content transitions with hardware acceleration */
.peek-content {
  position: absolute;
  inset: 0;
  border-radius: var(--radius);
  background-color: var(--portal-surface-bg);
  border: 1px solid var(--portal-surface-border);
  overflow: hidden;
  opacity: var(--peek-min-opacity);
  pointer-events: none;
  z-index: var(--portal-z-index);
  
  /* Optimized for high-performance hardware acceleration */
  transform: translate3d(0, 0, 0) scale(var(--peek-base-scale));
  transform-origin: center center;
  backface-visibility: hidden;
  -webkit-backface-visibility: hidden;
  perspective: 1000px;
  -webkit-perspective: 1000px;
  will-change: transform, opacity, backdrop-filter;
  
  /* Touch device optimization */
  touch-action: manipulation;
  -webkit-touch-callout: none;
  
  /* Default transition - simplified property list */
  transition: 
    opacity var(--peek-transition-duration) var(--peek-transition-timing),
    transform var(--peek-transition-duration) var(--peek-transition-timing),
    backdrop-filter var(--peek-transition-duration) var(--peek-transition-timing);
}

/* State-specific optimizations */
.peek-content.transitioning {
  transition: 
    opacity var(--peek-fast-transition),
    transform var(--peek-transition-duration) var(--peek-transition-timing),
    backdrop-filter var(--peek-transition-duration) var(--peek-transition-timing);
}

.peek-content.active {
  pointer-events: auto;
  box-shadow: 0 0 var(--portal-glow-radius) var(--portal-glow-size) var(--portal-glow-color);
}

/* Mobile-specific optimizations */
.peek-content-mobile {
  user-select: none;
  -webkit-user-select: none;
  
  /* Slightly slower transitions for better touch experience */
  transition: 
    opacity var(--peek-slow-transition),
    transform var(--peek-slow-transition),
    backdrop-filter var(--peek-slow-transition);
}

/* Pre-rendering optimization to prevent layout shifts */
.peek-content.prerender {
  opacity: 0 !important;
  transform: translate3d(0, 0, 0) scale(var(--peek-base-scale)) !important;
  backdrop-filter: blur(var(--peek-min-blur)) !important;
}

.peek-content.rendered {
  transition: 
    opacity var(--peek-transition-duration) var(--peek-transition-timing),
    transform var(--peek-transition-duration) var(--peek-transition-timing),
    backdrop-filter var(--peek-transition-duration) var(--peek-transition-timing);
}

/* Active state icon effects */
.peek-content.active svg {
  filter: drop-shadow(0 0 5px rgba(120, 120, 240, 0.5));
  transition: filter var(--peek-transition-duration) var(--peek-transition-timing);
}

/* GPU-accelerated card container */
.interactive-card-container {
  position: relative;
  overflow: visible;
  touch-action: manipulation; /* Prevent double-tap zoom */
  z-index: 1;
  will-change: transform;
  transform-style: preserve-3d;
  perspective: 1000px;
  contain: layout; /* Optimize layout calculations */
}

.interactive-card-surface {
  position: relative;
  border-radius: var(--radius);
  overflow: hidden;
  transform: translateZ(0);
  background-color: var(--portal-surface-bg);
  border: 1px solid var(--portal-surface-border);
  transition: 
    transform var(--peek-transition-duration) var(--peek-transition-timing),
    box-shadow var(--peek-transition-duration) var(--peek-transition-timing);
  contain: paint; /* Optimize paint operations */
}

.interactive-card-surface:hover {
  backface-visibility: hidden;
}

/* Enhanced peek-content when active */
.peek-content.active svg {
  filter: drop-shadow(0 0 5px rgba(var(--peek-glow-color), 0.7));
  transition: filter var(--peek-transition-duration) var(--peek-transition-timing);
}

/* Add glow effect to peek content icons when active */
.peek-content.active svg {
  filter: drop-shadow(0 0 5px rgba(var(--peek-glow-color), 0.7));
  transition: filter var(--peek-transition-duration) var(--peek-transition-timing);
}

/* Enhanced 3D effects with GPU optimization */
.transform-gpu {
  transform: translate3d(0, 0, 0);
  backface-visibility: hidden;
  perspective: var(--card-perspective);
  transform-style: preserve-3d;
  will-change: transform;
  contain: layout style paint;
  transform-origin: center center;
}

/* Portal effect styles with optimized masking */
.portal-mask {
  mask-image: var(--card-mask-gradient);
  -webkit-mask-image: var(--card-mask-gradient);
  contain: paint;
  pointer-events: none;
}

/* Optimized hover transitions */
.hover-transition {
  transition: 
    transform var(--card-transition-duration) var(--card-transition-timing),
    box-shadow var(--card-transition-duration) var(--card-transition-timing);
  will-change: transform, box-shadow;
  transform-origin: center center;
}

/* Shadow variations with dynamic color and containment */
.shadow-light {
  box-shadow: 0 2px 4px var(--card-shadow-color);
  will-change: box-shadow;
  contain: paint;
}

.shadow-medium {
  box-shadow: 0 4px 8px var(--card-shadow-color);
  will-change: box-shadow;
  contain: paint;
}

.shadow-heavy {
  box-shadow: 0 8px 16px var(--card-shadow-color);
  will-change: box-shadow;
  contain: paint;
}

/* Dark mode adjustments with CSS variables */
@media (prefers-color-scheme: dark) {
  :root {
    --card-shadow-color: var(--card-shadow-color-dark);
    --peek-glow-intensity: 0.6;
  }
}

/* Reduced motion preferences - completely disable animations */
@media (prefers-reduced-motion: reduce) {
  :root {
    --peek-transition-duration: 0ms;
    --card-transition-duration: 0ms;
    --card-tilt-factor: 0;
    --card-scale-factor: 0;
  }
  
  .transform-gpu,
  .peek-content,
  .interactive-card-surface {
    transition: none !important;
    transform: none !important;
    animation: none !important;
    will-change: auto;
  }
}

/* Performance optimizations */
.performance-critical {
  contain: layout style paint;
  will-change: transform, opacity;
  transform: translateZ(0);
  pointer-events: none;
}

/* Layer stacking context optimization */
.layer-stack {
  isolation: isolate;
  position: relative;
  z-index: 1;
  contain: layout;
}

/* Intersection observer fade-in animation */
.fade-in {
  opacity: 0;
  transition: opacity var(--card-transition-duration) var(--card-transition-timing);
  will-change: opacity;
  contain: paint;
}

.fade-in.visible {
  opacity: 1;
}

/* Touch device optimizations */
@media (hover: none) {
  :root {
    --card-tilt-factor: 0.25;
    --card-scale-factor: 0.1;
    --peek-min-opacity: 0.35;
    --peek-min-blur: 3px;
    --peek-active-blur: 8px;
    --peek-glow-intensity: 0.7;
    --peek-transition-duration: 250ms;
  }

  .transform-gpu {
    transform-style: flat;
    perspective: none;
    will-change: auto;
  }
  
  .peek-content.active {
    transition-duration: var(--peek-transition-duration);
  }
}

/* High-performance animations */
@keyframes tilt-shake {
  0%, 100% { transform: rotate3d(0, 0, 1, 0deg); }
  25% { transform: rotate3d(0, 0, 1, 0.5deg); }
  75% { transform: rotate3d(0, 0, 1, -0.5deg); }
}

.tilt-animation {
  animation: tilt-shake 10s cubic-bezier(0.16, 1, 0.3, 1) infinite;
  animation-play-state: paused;
}

.tilt-animation:hover {
  animation-play-state: running;
}

/* Fully activated portal glow effect */
.portal-active-glow {
  box-shadow: 0 0 15px rgba(var(--portal-glow-color), var(--peek-glow-intensity));
}

/* Portal icon glow effect */
.portal-icon-glow {
  filter: drop-shadow(0 0 8px rgba(var(--portal-glow-color), 0.7));
} 